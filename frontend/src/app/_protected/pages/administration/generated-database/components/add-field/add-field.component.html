<h3 mat-dialog-title>Add new table</h3>

<div mat-dialog-content class="new-field-dialog">
  <mat-tab-group mat-stretch-tabs dynamicHeight animationDuration="0ms" (selectedTabChange)="tabsCahnged($event)">
    <mat-tab label="New column">
      <mat-form-field class="w-100 text-prefix mt-4">
        <span matPrefix class="d-flex flex-nowrap align-items-center justify-content-between me-3">
          Column's name
        </span>

        <input matInput type="text" placeholder="Column's name" [(ngModel)]="formData.columnName" [pattern]="CommonRegEx.appNameWithUppercase">
        <mat-error>{{CommonErrorMessages.appNameWithUppercase}}</mat-error>
      </mat-form-field>

      <mat-form-field class="w-100 text-prefix">
        <span matPrefix class="d-flex flex-nowrap align-items-center justify-content-between me-3">
          Field's type
        </span>

        <mat-select placeholder="Type" [(ngModel)]="formData.fieldType" (ngModelChange)="changeDefaultValue()">
          <mat-select-trigger>
            {{formData?.fieldType?.name}}
          </mat-select-trigger>
          <mat-option
            class="multiline-mat-option"
            *ngFor="let item of fieldTypeList[data.slectedDbType]"
            [value]="item">
            <span class="d-block name-line" #typeName>{{item.name}}</span>
            <span class="d-block description-line">{{item.description}}</span>
          </mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field class="w-100 text-prefix" *ngIf="formData?.fieldType?.size">
        <span matPrefix class="d-flex flex-nowrap align-items-center justify-content-between me-3">
          Field's size
        </span>

        <input matInput type="number"
          [placeholder]="'Size between ' + formData.fieldType.size.min + ' and ' + formData.fieldType.size.max"
          [(ngModel)]="formData.columnLength"
          [pattern]="CommonRegEx.appNameWithUppercase"
          [min]="formData.fieldType.size.min"
          [max]="formData.fieldType.size.max"
          autocomplete="off"
          name="-">
        <mat-hint class="text-danger"
          *ngIf="formData.columnLength < formData.fieldType.size.min || formData.columnLength > formData.fieldType.size.max">
          {{'Size between ' + formData.fieldType.size.min + ' and ' + formData.fieldType.size.max}}
        </mat-hint>
      </mat-form-field>

      <mat-form-field class="w-100 text-prefix" *ngIf="formData?.fieldType?.defaultValue">
        <span matPrefix class="d-flex flex-nowrap align-items-center justify-content-between me-3">
          Default value (optional)
        </span>

        <input matInput type="text" placeholder="Column's default value" [(ngModel)]="formData.defaultValue" [pattern]="CommonRegEx.appNameWithUppercase">
        <mat-error>{{CommonErrorMessages.appNameWithUppercase}}</mat-error>
      </mat-form-field>

      <p class="d-flex justify-content-end">
        <mat-checkbox [(ngModel)]="formData.nullable" color="primary">Nullable?</mat-checkbox>
      </p>
    </mat-tab>

    <mat-tab label="Foreign key">
      <mat-form-field class="w-100 text-prefix mt-4">
        <span matPrefix class="d-flex flex-nowrap align-items-center justify-content-between me-3">
          Foreign table
        </span>

        <mat-select placeholder="Foreign table" [(ngModel)]="formData.selectedTable">
          <mat-select-trigger>
            {{formData?.selectedTable?.name}}
          </mat-select-trigger>
          <mat-option
            class="multiline-mat-option"
            *ngFor="let item of data.tables"
            [value]="item">{{item?.name}}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field class="w-100 text-prefix">
        <span matPrefix class="d-flex flex-nowrap align-items-center justify-content-between me-3">
          Foreign table's column
        </span>

        <mat-select placeholder="Foreign table's column" [(ngModel)]="formData.foreignField" (selectionChange)="changeColumnName()">
          <mat-option
            class="multiline-mat-option"
            *ngFor="let item of formData.selectedTable?.columns"
            [value]="item?.name">{{item?.name}}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field class="w-100 text-prefix">
        <span matPrefix class="d-flex flex-nowrap align-items-center justify-content-between me-3">
          Column's name
        </span>

        <input matInput type="text" placeholder="Column's name"
          [value]="formData.foreignField ? formData.foreignField : ''"
          [(ngModel)]="formData.columnName" [pattern]="CommonRegEx.appNameWithUppercase">
        <mat-error>{{CommonErrorMessages.appNameWithUppercase}}</mat-error>
      </mat-form-field>

      <p class="d-flex justify-content-end">
        <mat-checkbox [(ngModel)]="formData.nullable" color="primary" class="me-2">Nullable?</mat-checkbox>
        <mat-checkbox [(ngModel)]="formData.cascading" color="primary">Cascade</mat-checkbox>
      </p>
    </mat-tab>
  </mat-tab-group>
</div>

<div mat-dialog-actions [align]="'end'">
  <button mat-button mat-dialog-close>Cancel</button>
  <button mat-flat-button color="primary" class="px-4" (click)="create()">Create</button>
</div>
