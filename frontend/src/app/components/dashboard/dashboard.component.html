

<ng-container [ngSwitch]="true">
  <!-- if authenticated -->
  <ng-container *ngSwitchCase="backendService.active?.token !== null">
    <ng-template [ngIf]="backendService.active?.token?.in_role('root')" [ngIfElse]="isNotRoot">
      <ng-template [ngIf]="systemReportDisplayable !== null" [ngIfElse]="noReport">
        <div class="row manipuated-layout">
          <div class="col-12 mb-general">
            <div class="row justify-content-between">
              <div class="col-xl-4 col-lg-6 col-md-8 col-12">
                <app-overview [data]="systemReportDisplayable"></app-overview>
              </div>
              <div class="col-xl-4 col-lg-6 col-md-4 col-sm-6 col-12">
                <app-doughnut-chart [data]="systemReportDisplayable"></app-doughnut-chart>
              </div>
              <div class="col-xl-4 col-lg-4 col-md-5 col-sm-6 col-12">
                <app-pie-chart [data]="systemReportDisplayable"></app-pie-chart>
              </div>
              <div class="col-xl-7 col-lg-8 col-12 order-md-5 order-lg-4">
                <app-last-log-items [data]="systemReportDisplayable?.last_log_items" [totalLogs]="systemReportDisplayable?.log_items"></app-last-log-items>
              </div>
              <div class="col-xl-5 col-lg-8 col-md-7 col-12 order-md-4 order-lg-5 order-6">
                <ng-container *ngFor="let chartItem of chartData | keyvalue:unsorted; let index = index;">
                  <ng-container *ngIf="index===0">
                    <div class="w-100 h-100 d-flex flex-column">
                     <div class="row h-100 mt-4 no-gutters">
                      <div class="col-12 mb-3">
                        <div class="d-flex justify-content-between w-100">
                          <div>
                            <h2 class="mb-0">{{chartItem.value?.name}}</h2>
                            <p class="mt-0 text-muted">{{chartItem.value?.description}}
                              <small class="text-muted">(last 14 days)</small>
                            </p>
                          </div>
                          <div>
                            <button mat-icon-button (click)="chartType[index] = !chartType[index]">
                              <mat-icon>{{chartType[index] ? 'show' : 'bar'}}_chart</mat-icon>
                            </button>
                          </div>
                        </div>
                      </div>
                       <div class="col-12 mb-3">
                        <mat-card class="h-100">
                          <mat-card-content class="min-h-300 h-100">
                            <canvas baseChart
                              [data]="chartItem.value?.data" 
                              [labels]="chartItem.value?.label"
                              [options]="barChartOptions"
                              [chartType]="!chartType[index] ? 'line' : 'bar'"
                              [colors]="colors">
                            </canvas>
                          </mat-card-content>
                        </mat-card>
                       </div>
                     </div>
                    </div>
                  </ng-container>
                </ng-container>
              </div>
              <ng-container *ngFor="let chartItem of chartData | keyvalue:unsorted; let index = index;let first = first">
                <ng-container *ngIf="index>0">
                  <div class="d-flex flex-column col-xl-6 {{index===1 ? 'col-lg-4' : ''}} col-sm-6 order-{{7 + index}}"
                    >
                    <!-- <ng-container *ngIf="index > 0"> -->
                      <div class="row h-100 mt-4 no-gutters">
                        <div class="col-12 mb-3">
                          <div class="d-flex justify-content-between w-100">
                            <div>
                              <h2 class="mb-0">{{chartItem.value?.name}}</h2>
                              <p class="text-muted mt-0">{{chartItem.value?.description}}
                                <small class="text-muted">(last 14 days)</small>
                              </p>
                            </div>
                            <div>
                              <button mat-icon-button (click)="chartType[index] = !chartType[index]">
                                <mat-icon>{{chartType[index] ? 'show' : 'bar'}}_chart</mat-icon>
                              </button>
                            </div>
                          </div>
                        </div>
                        <div class="col-12 mb-3">
                          <mat-card class="h-100">
                            <mat-card-content class="min-h-300">
                              <canvas baseChart
                                [data]="chartItem.value?.data" 
                                [labels]="chartItem.value?.label"
                                [options]="barChartOptions"
                                [chartType]="!chartType[index] ? 'line' : 'bar'"
                                [colors]="colors">
                              </canvas>
                            </mat-card-content>
                          </mat-card>
                        </div>
                      </div>
                    <!-- </ng-container> -->
                  </div>
                </ng-container>
              </ng-container>
            </div>
          </div>
        </div>
      </ng-template>
      <ng-template #noReport>
        <div class="d-flex flex-column align-items-center justify-content-center text-center h-100 w-100 welcome-section">
          <h1 class="mat-title">Welcome to Aista Magic Cloud</h1>
          <p class="mat-subheading-2 mb-4">Your backend is not configured yet.</p>
          <div class="mt-4">
            <p class="mb-0">Configure your backend to see a full report on your system here.</p>
            <h3>Navigate to the <a routerLink="/config">config page.</a></h3>
          </div>
        </div>
      </ng-template>
    </ng-template>
    <ng-template #isNotRoot>
      <div class="d-flex flex-column align-items-center justify-content-center text-center h-100 w-100 welcome-section">
        <h1 class="mat-title">Welcome to Aista Magic Cloud</h1>
        <p class="mat-subheading-2 mb-4">Navigate through pages to see how you can interact with the system.</p>
        <div class="mt-4">
          <p class="mb-0">Not sure what you can do here?</p>
          <h3>Check out the <a href="https://docs.aista.com/" target="_blank">documentation</a> to learn more.</h3>
        </div>
      </div>
    </ng-template>
  </ng-container>
  <!-- if NOT authenticated -->
  <ng-container *ngSwitchCase="backendService.active?.token === null">
    <div class="d-flex flex-column align-items-center justify-content-center text-center h-100 w-100 welcome-section">
      <h1 class="mat-title">Welcome to Aista Magic Cloud</h1>
      <p class="mat-subheading-2 mb-0">If you already have a username you can login below.</p>
      <p class="mat-subheading-2 mb-4">Don't have an account on this server yet? Register below!</p>
      <div class="d-flex">
        <button mat-flat-button class="mr-1" color="primary" (click)="login()">Login</button>
        <button mat-flat-button class="mr-1" color="accent" routerLink="/register">Register</button>
      </div>
      <div class="mt-4">
        <p class="mb-0">Not sure where to start?</p>
        <h3>Check out the <a href="https://docs.aista.com/" target="_blank">documentation</a> to get started.</h3>
      </div>
    </div>
  </ng-container>
</ng-container>
