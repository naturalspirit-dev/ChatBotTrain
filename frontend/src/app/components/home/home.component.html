
<div
  class="obscurer"
  *ngIf="isFetching">
  <h3>Please wait ...</h3>
  <h4>Genius is thinking ...</h4>
  <mat-spinner
    mode="indeterminate"
    diameter="50"
    class="ajax-wait">
  </mat-spinner>
</div>

<h1>Magic Dashboard</h1>

<mat-card
  *ngIf="!licenseInfo || licenseInfo.version === 'trial'"
  class="info-card">

  <div
    class="what-is-next"
    *ngIf="status && (status.magic_crudified === false || status.server_keypair === false)">
    <h3>What's next?</h3>
    <ul>
      <li *ngIf="status.magic_crudified === false">Crudify your Magic database in the "Crudify" menu item</li>
      <li *ngIf="status.server_keypair === false">Generate a server key pair in the "Crypto" menu item</li>
    </ul>
  </div>

  <p>
    You seem to be using a trial version of Magic. This version will stop working after 47 hours.
    Click the button in the top right corner to obtain a license, and paste in your license
    in the text box below.
  </p>

  <mat-form-field style="width: 100%;">
    <textarea
      matInput
      placeholder="License"
      matTooltip="License as obtained from Server Gardens"
      rows="4"
      [(ngModel)]="license">
    </textarea>
  </mat-form-field>

  <div class="save-license">
    <button
      [disabled]="license === ''"
      mat-raised-button
      (click)="saveLicense()"
      color="primary">Save license</button>
  </div>

  <a
    mat-button
    color="primary"
    rel="noopener noreferrer"
    class="obtain-license"
    target="_blank"
    href="https://servergardens.com/buy">Get licensed</a>

  <div class="copyright">
    Copyright © Thomas Hansen, info@servergardens.com, all rights reserved -
    <a rel="noopener noreferrer" href="https://polterguy.github.io" target="_blank">Read more about Magic</a>
  </div>

  <small class="version">Version {{getVersion()}}</small>

</mat-card>

<mat-card
  *ngIf="licenseInfo && licenseInfo.version !== 'trial'"
  class="license-card">

  <div
    class="what-is-next"
    *ngIf="status && (status.magic_crudified === false || status.server_keypair === false)">
    <h3>What's next?</h3>
    <ul>
      <li *ngIf="status.magic_crudified === false">Crudify your Magic database in the "Crudify" menu item</li>
      <li *ngIf="status.server_keypair === false">Generate a server key pair in the "Crypto" menu item</li>
    </ul>
  </div>

  <div
    *ngIf="status && (status.magic_crudified === true && status.server_keypair === true)"
    class="finished-setup">
    <mat-icon
      matTooltip="Your server has been correctly setup and is properly licensed">check</mat-icon>
  </div>

  <table
    *ngIf="status && (status.magic_crudified === true && status.server_keypair === true)"
    [matTooltip]="getAllowanceOfLicense(licenseInfo['license-type'])">
    <caption>License information</caption>
    <tr>
      <th scope="col">Type</th>
      <th scope="col">Value</th>
    </tr>
    <tr>
      <td>Name</td>
      <td>{{licenseInfo.name}}</td>
    </tr>
    <tr>
      <td>Email</td>
      <td>{{licenseInfo.email}}</td>
    </tr>
    <tr>
      <td>Issued</td>
      <td>{{getLocalDate(licenseInfo.issued)}}</td>
    </tr>
    <tr>
      <td>License type</td>
      <td>{{licenseInfo['license-type']}}</td>
    </tr>
    <tr>
      <td>Valid</td>
      <td>Version {{licenseInfo['valid-version']}}</td>
    </tr>
    <tr *ngIf="licenseInfo.expires">
      <td>Expires</td>
      <td>{{licenseInfo.expires}}</td>
    </tr>
  </table>

  <div class="copyright">
    Copyright © Thomas Hansen, info@servergardens.com, all rights reserved -
    <a rel="noopener noreferrer" href="https://polterguy.github.io" target="_blank">Documentation</a>
  </div>

  <small class="version">Version {{getVersion()}}</small>

</mat-card>

<mat-card
  *ngIf="locLog"
  class="loc-card">

  <table>
    <caption>Work done by Magic</caption>
    <tr>
      <th scope="col">Type</th>
      <th scope="col">Value</th>
    </tr>
    <tr>
      <td>Total</td>
      <td matTooltip="LOC created by Magic in total">{{locLog.backend + locLog.frontend}}</td>
    </tr>
    <tr>
      <td>Frontend</td>
      <td matTooltip="Frontend LOC created by Magic">{{locLog.frontend}}</td>
    </tr>
    <tr>
      <td>Backend</td>
      <td matTooltip="Backend LOC created by Magic">{{locLog.backend}}</td>
    </tr>
    <tr>
      <td>Man days of work</td>
      <td matTooltip="Days a human would need to deliver the same">{{getManDaysLocalString()}}</td>
    </tr>
    <tr>
      <td>Man months of work</td>
      <td matTooltip="Months a human would need to deliver the same">{{(getManDays() / 22).toLocaleString(undefined, { maximumFractionDigits: 2 })}}</td>
    </tr>
    <tr>
      <td>ROI</td>
      <td matTooltip="Return of investment in percentage">{{getROI()}}%</td>
    </tr>
  </table>

  <div class="chart">
    <canvas
      baseChart 
      [data]="pieChartData" 
      [labels]="pieChartLabels" 
      [chartType]="pieChartType"
      [options]="pieChartOptions"
      [plugins]="pieChartPlugins"
      [legend]="pieChartLegend">
    </canvas>
  </div>

</mat-card>
