
<mat-form-field class="w-100" appearance="outline">

  <mat-label>Filter</mat-label>
  <input
    matInput
    type="text"
    autocomplete="off"
    [formControl]="filterFormControl">
  <mat-icon
    matSuffix
    *ngIf="filterFormControl.value.trim() !== ''"
    class="button"
    role="button"
    (click)="clearFilter()">clear</mat-icon>

</mat-form-field>

<div class="table-responsive">
  <table
    mat-table
    [dataSource]="invocations"
    class="w-100 expandable-table"
    multiTemplateDataRows>

    <ng-container matColumnDef="request_id">
      <td mat-cell *matCellDef="let el">{{el.request_id}}</td>
    </ng-container>

    <ng-container matColumnDef="created">
      <td mat-cell *matCellDef="let el" class="mini-col">{{el.created | since}}</td>
    </ng-container>

    <ng-container matColumnDef="showDetails">
      <td mat-cell *matCellDef="let el" colspan="2">
        <div class="w-100 details-row"
          [@detailExpand]="el == expandedElement ? 'expanded' : 'collapsed'">
          <div class="w-100">
            <mat-list class="detail-list mb-3">
              <mat-list-item>
                <div mat-line>Date</div>
                <div mat-line class="copy-to-clipboard" (click)="copyToClipboard(el.created)">{{el.created}}</div>
              </mat-list-item>
              <mat-list-item>
                <div mat-line>ID</div>
                <div mat-line class="copy-to-clipboard" (click)="copyToClipboard(el.request_id)">{{el.request_id}} </div>
              </mat-list-item>
              <mat-list-item>
                <div mat-line>Full name</div>
                <div mat-line class="copy-to-clipboard"
                (click)="copyToClipboard(getCryptoKeySubject(el.crypto_key))">{{getCryptoKeySubject(el.crypto_key)}} </div>
              </mat-list-item>
              <mat-list-item>
                <div mat-line>Key fingerprint</div>
                <div mat-line class="copy-to-clipboard"
                (click)="copyToClipboard(getCryptoKeyFingerprint(el.crypto_key))">{{getCryptoKeyFingerprint(el.crypto_key)}} </div>
              </mat-list-item>
              <mat-list-item>
                <div mat-line>Request</div>
                <div mat-line class="code copy-to-clipboard" (click)="copyToClipboard(el.request)">{{el.request}}</div>
              </mat-list-item>
              <mat-list-item>
                <div mat-line>Signed request</div>
                <div mat-line class="no-overflow copy-to-clipboard" (click)="copyToClipboard(el.request_raw)">{{el.request_raw}} </div>
              </mat-list-item>
              <mat-list-item>
                <div mat-line>Response</div>
                <div mat-line class="code">{{el.response}} </div>
              </mat-list-item>
            </mat-list>
          </div>
        </div>
      </td>
    </ng-container>

    <tr
      mat-row
      [ngClass]="expandedElement === el ? 'selected ' + ' invocation-row' : ''"
      class="expandable-row"
      (click)="toggleDetails(el);expandedElement = expandedElement === el ? null : el"
      *matRowDef="let el; columns: displayedColumns;"></tr>

    <tr mat-row *matRowDef="let el; columns: ['showDetails']" class="expanded-row"></tr>

  </table>
</div>

<mat-paginator
  #paginator
  [class]="count > 10 ? '' : 'invisible'"
  [length]="count"
  pageSize="10"
  showFirstLastButtons="true"
  (page)="paged($event)"
  [pageSizeOptions]="[5,10,25,50]">
</mat-paginator>
