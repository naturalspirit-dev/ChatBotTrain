
<div class="setup-wrapper">

    <div class="mat-elevation-z4 setup">

      <h3>Setup wizard</h3>

      <p>
        You have to setup your system such that it provides a real authentication scheme. The things you will have to change are as follows.
      </p>

      <ul>
        <li><em>"secret"</em> in the magic/auth/secret parts. Provide a random string of characters, at least 50 characters in length to improve entropy.</li>
        <li>Database connection string of choice. This depends upon if you want to use MySQL or MS SQL as your primary database.</li>
      </ul>

      <p>
        When you are done, you can crudify the <em>"magic_auth"</em> database to make the <em>"Users"</em> module
        work, allowing you to add, edit, and delete users in your installation.
      </p>

      <div class="database-selector">
        <mat-select
          placeholder="Select database type"
          (selectionChange)="databaseTypeChanged($event)"
          [(value)]="selectedDatabaseType">
          <mat-option *ngFor="let cur of databaseTypes" [value]="cur">{{cur}}</mat-option>
        </mat-select>
      </div>

      <mat-form-field
        *ngIf="selectedDatabaseType !== null"
        class="username">
        <input 
          matInput 
          autocomplete="off"
          readonly
          type="text" 
          placeholder="Root username"
          [(ngModel)]="username">
      </mat-form-field>

      <mat-form-field
        *ngIf="selectedDatabaseType !== null"
        class="password">
        <input 
          matInput 
          [disabled]="validDatabaseConnectionString !== true"
          autocomplete="new-password"
          type="password" 
          placeholder="Root password"
          [(ngModel)]="password">
      </mat-form-field>

      <mat-form-field
        *ngIf="selectedDatabaseType !== null"
        class="password-repeat">
        <input 
          matInput 
          [disabled]="validDatabaseConnectionString !== true"
          autocomplete="new-password"
          type="password" 
          placeholder="Repeat password"
          [(ngModel)]="passwordRepeat">
      </mat-form-field>

      <button
        *ngIf="selectedDatabaseType !== null"
        [disabled]="validDatabaseConnectionString !== true"
        class="save-button"
        matTooltip="This might take some time"
        mat-button
        (click)="setupAuthentication()">
        Setup
      </button>

      <div
        *ngIf="selectedDatabaseType !== null"
        class="air-top">
        <ngx-codemirror
          [(ngModel)]="appsettingsJson" 
          class="smaller"
          [options]="getCodeMirrorOptions()"></ngx-codemirror>
        <div
          style="text-align: right;">
          <button
            matTooltip="Saves your configuration file"
            (click)="saveConfigurationFile()"
            mat-button>Save</button>
        </div>
      </div>

      <div
        *ngIf="embarrassing"
        class="warning">
        <h3 style="text-align: center;">OK, this is embarrassing</h3>
        <p>
          Something went very wrong ...
        </p>
        <p>
          We would highly appreciate it if you could send us your <em>"/magic.backend/logs/magic.log"</em> file, such that
          we can hopefully figure out what went wrong. If you want to do this, you can send the entire magic.log file to
          <a href="mailto:support@servergardens.com">support@servergardens.com</a>, and if you could provide us with as much
          information as possible about your particular setup, it would also help us a lot. Information we'd love to have is
          as follows.
        </p>
        <ul>
          <li>Operating system (Windows/Linux/OSX/etc)</li>
          <li>Database type and version (e.g. MySQL version 5.8.4, etc)</li>
          <li>Magic version (this should be visible in your home link)</li>
          <li>Collation, Default character set, etc - for your specific database</li>
          <li>Etc ...</li>
        </ul>
        <p>
          If you don't know this, or don't really care, as much as you would care to send us, would be of great help - In addition to
          the entire contents of your <em>"magic.log"</em> file of course. Yet again, send this information to.
        </p>
        <p>
          <a href="mailto:support@servergardens.com">support@servergardens.com</a>
        </p>
        <p>
          Please ...
        </p>
        <p>
          Kind Regards,
        </p>
        <p>
          Thomas Hansen - CEO at Server Gardens
        </p>
      </div>
      
    </div>

  </div>
