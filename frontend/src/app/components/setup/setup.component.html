
<div class="setup-wrapper">

    <div class="mat-elevation-z4 setup">

      <h3>Setup wizard</h3>

      <p>
        You have to setup your system such that it provides a real authentication scheme. Notice, this will permanently change
        the state of your installation, so be careful, and make sure you have chosen the correct database type that you wish to
        use. You can find any files that are overwritten in the process in your <em>"trash"</em> folder. Also, your connection
        string must be correct at this point, for the specific database type you wish to use. Edit it in your
        <em>"appsettings.json"</em> file if you haven't done so already. While you're editing your appsettings.json file,
        make sure you also edit your JWT secret.
      </p>

      <p>
        When you are done, you can crudify the <em>"magic_auth"</em> database to make the <em>"Users"</em> module
        work, allowing you to add, edit and delete users in your installation.
      </p>

      <div class="database-selector">
        <mat-select
          placeholder="Select database type"
          (selectionChange)="databaseTypeChanged($event)"
          [(value)]="selectedDatabaseType">
          <mat-option *ngFor="let cur of databaseTypes" [value]="cur">{{cur}}</mat-option>
        </mat-select>
      </div>

      <mat-form-field
        *ngIf="selectedDatabaseType !== null"
        class="username">
        <input 
          matInput 
          autocomplete="off"
          readonly
          type="text" 
          placeholder="Root username"
          [(ngModel)]="username">
      </mat-form-field>

      <mat-form-field
        *ngIf="selectedDatabaseType !== null"
        class="password">
        <input 
          matInput 
          [disabled]="validDatabaseConnectionString !== true"
          autocomplete="new-password"
          type="password" 
          placeholder="Root password"
          [(ngModel)]="password">
      </mat-form-field>

      <mat-form-field
        *ngIf="selectedDatabaseType !== null"
        class="password-repeat">
        <input 
          matInput 
          [disabled]="validDatabaseConnectionString !== true"
          autocomplete="new-password"
          type="password" 
          placeholder="Repeat password"
          [(ngModel)]="passwordRepeat">
      </mat-form-field>

      <button
        *ngIf="selectedDatabaseType !== null"
        [disabled]="validDatabaseConnectionString !== true || validJwtSecret !== true"
        class="save-button"
        matTooltip="This might take some time"
        mat-button
        (click)="setupAuthentication()">
        Setup
      </button>

      <div class="air-top">
        <ngx-codemirror
          [(ngModel)]="appsettingsJson" 
          class="smaller"
          [options]="getCodeMirrorOptions()"></ngx-codemirror>
        <div
          style="text-align: right;">
          <button
            matTooltip="Saves your configuration file"
            (click)="saveConfigurationFile()"
            mat-button>Save</button>
        </div>
      </div>
      
    </div>

  </div>
