<div id="navbar" class="d-flex align-items-center justify-content-lg-between mat-elevation-z2">

  <button mat-icon-button color="primary" class="d-xl-none d-block me-2" (click)="toggleSidebar()">
    <mat-icon>menu</mat-icon>
  </button>
  <a class="me-xl-0 me-auto pointer" routerLink="/">
    <img src="../../../../assets/images/aista-logo.svg" alt="Aista Ltd." height="20" class="my-auto d-sm-block d-none">
    <img src="../../../../assets/images/icons/apple-icon-180x180.png" alt="Aista Ltd." height="50" class="my-auto d-sm-none d-block">
  </a>


  <div class="nav-links mx-auto  d-flex flex-xl-row flex-column" [class.open]="sideExpanded">
    <img src="../../../../assets/images/aista-logo.svg" alt="Aista Ltd." height="20"
    class="mx-auto d-block d-xl-none mb-4">

    <!-- ONLY to be displayed on medium size screens and smaller -->
    <div class="d-md-none d-block mb-4">
      <button mat-button [matMenuTriggerFor]="account" class="mx-auto d-block">
        <div class="d-flex flex-nowrap align-items-center ps-1">
          <mat-icon>account_circle</mat-icon>
          <p class="my-0 mx-2 text-truncate email-text">{{username}}</p>
          <mat-icon>expand_more</mat-icon>
        </div>
      </button>
    </div>

    <a mat-button class="nav-link" routerLink="/" [routerLinkActiveOptions]="{exact: true}"
      routerLinkActive="active-link" #isActiveLink="routerLinkActive" (click)="closeSidebarInSidePanel()">Dashboard</a>

    <a mat-button class="nav-link" routerLink="/cloudlets" [routerLinkActiveOptions]="{exact: false}"
      routerLinkActive="active-link" #isActiveLink2="routerLinkActive" (click)="closeSidebarInSidePanel()">Cloudlets</a>

    <a mat-button class="nav-link" routerLink="/support" [routerLinkActiveOptions]="{exact: false}"
      routerLinkActive="active-link" #isActiveLink="routerLinkActive" (click)="closeSidebarInSidePanel()">Support</a>

    <a mat-button class="nav-link" routerLink="/invoices" [routerLinkActiveOptions]="{exact: true}"
      routerLinkActive="active-link" #isActiveLink="routerLinkActive" (click)="closeSidebarInSidePanel()">Invoices</a>

    <a mat-button class="nav-link" *ngIf="isAffiliate" routerLink="affiliate" [routerLinkActiveOptions]="{exact: true}"
      routerLinkActive="active-link" #isActiveLink="routerLinkActive" (click)="closeSidebarInSidePanel()">Affiliates</a>

    <!-- ONLY to be displayed on medium size screens and smaller -->
    <div class="d-md-none d-block mt-auto">
      <a mat-button class="justify-content-center w-100 logout-btn" color="warn" (click)="logout()">Logout</a>
    </div>
  </div>

  <div class="d-flex align-items-center">
    <button mat-icon-button color="primary" [matMenuTriggerFor]="notifications" class="me-xl-4 bell-button"
      (click)="getNotifications()" [class.hasUnread]="notificationList?.length > 0"
      #notificationHeaderMenu="matMenuTrigger"
      [class.isOpen]="notificationHeaderMenu.menuOpen">
      <mat-icon>notifications</mat-icon>
    </button>


    <button mat-button [matMenuTriggerFor]="account" color="primary" class="d-md-block d-none me-1">
      <div class="d-flex flex-nowrap align-items-center ps-1">
        <mat-icon>account_circle</mat-icon>
        <p class="my-0 mx-2 text-truncate email-text">{{username}}</p>
        <mat-icon>expand_more</mat-icon>
      </div>
    </button>
    <button mat-flat-button color="primary" class="nav-button ps-2" routerLink="/cloudlets/create">
      <div class="d-flex flex-nowrap align-items-center ps-sm-0">
        <mat-icon class="me-0">add</mat-icon>
        <span class="d-sm-block d-none">Create cloudlet</span>
        <span class="d-sm-none d-block">Cloudlet</span>
      </div>
    </button>

  </div>
</div>
<!-- Account dowpdown menu -->
<mat-menu #account="matMenu" class="account-menu">
  <button mat-menu-item class="dropdown-link" routerLink="/my-profile" [routerLinkActiveOptions]="{exact: true}"
    routerLinkActive="active-link" #isActiveLink="routerLinkActive" (click)="closeSidebarInSidePanel()">My profile</button>
  <button mat-menu-item class="dropdown-link" routerLink="/account-security"
    [routerLinkActiveOptions]="{exact: true}" routerLinkActive="active-link"
    #isActiveLink="routerLinkActive" (click)="closeSidebarInSidePanel()">Security</button>
  <button mat-menu-item class="dropdown-link" routerLink="/payment-methods"
    [routerLinkActiveOptions]="{exact: true}" routerLinkActive="active-link"
    #isActiveLink="routerLinkActive" (click)="closeSidebarInSidePanel()">Payment methods</button>
  <button mat-menu-item class="dropdown-link" routerLink="/setting" [routerLinkActiveOptions]="{exact: true}"
    routerLinkActive="active-link" #isActiveLink="routerLinkActive" (click)="closeSidebarInSidePanel()">Settings</button>


  <button mat-menu-item class="dropdown-link d-md-block d-none" (click)="logout()" (click)="closeSidebarInSidePanel()">Logout</button>
</mat-menu>

<!-- Notification panel -->
<mat-menu #notifications="matMenu" class="notifications-menu" backdropClass="notifications-backdrop" xPosition="before">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3 class="my-0 fw-bold">Notifications</h3>
    <a mat-button color="primary" routerLink="/notifications">See all</a>
  </div>
  <a class="d-flex flex-column coloured-box p-3" *ngFor="let item of notificationList; let last = last"
    [class.mb-3]="!last">
    <p class="mt-0 truncatable">{{item.content}}</p>
    <em class="mb-0 text-muted ms-auto">{{item.created | friendlyDate}}</em>
  </a>
  <ng-container *ngIf="!notificationList || notificationList.length === 0">
    <p class="mt-0 truncatable">All is good!</p>
  </ng-container>

</mat-menu>

<div class="overlay" *ngIf="sideExpanded" (click)="toggleSidebar()"></div>
