
// OpenAI chat endpoint, for having conversations using "gpt-xxx" models.
.arguments
   prompt:string
   type:string
   recaptcha_response:string
.description:OpenAI AI search endpoint returning only references to matching training snippets
.type:public

// Invoking slot containing commonalities for all endpoints.
insert-before:x:../*/signal/*/.callback
   get-nodes:x:@.arguments/*
signal:magic.ai.endpoint-common
   .callback

      // Checking what type of model this is, and invoking correct slot accordingly.
      add:x:+
         get-nodes:x:@.arguments/*
      signal:magic.ai.get-context
      add:x:./*/return-nodes/*/snippets
         get-nodes:x:@signal/*/snippets/*/[0,5]
      add:x:./*/return-nodes
         get-nodes:x:@signal/*/db_time
      return-nodes
         snippets

/*
 * Applying some HTTP caching to avoid invoking OpenAI again with
 * the same question before some minimum amount of time has passed.
 */
response.headers.set
   Cache-Control:max-age=30

// Returning result of worker slot to caller.
return-nodes:x:@signal/*
